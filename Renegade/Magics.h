#pragma once
#include <random>
#include "Utils.h"

// Methods:
void GenerateMagicTables();
extern uint64_t GetRookAttacks(const uint8_t square, const uint64_t occupancy);
extern uint64_t GetBishopAttacks(const uint8_t square, const uint64_t occupancy);
extern uint64_t GetQueenAttacks(const uint8_t square, const uint64_t occupancy);
extern uint64_t GetConnectingRay(const uint8_t from, const uint64_t to);

// Attack lookup tables (generated at runtime)
static std::array<std::array<uint64_t, 4096>, 64> RookAttacks;
static std::array<std::array<uint64_t, 512>, 64> BishopAttacks;
static std::array<std::array<uint64_t, 64>, 64> ConnectingRays;

// Pregenerated random magic numbers
// Think of: https://xkcd.com/221/

static constexpr std::array<uint64_t, 64> RookMagicNumbers = {
	0x0080001080284000, 0x1040002000100040, 0x0880100080082000, 0x1080100004080080, 0x4200102008040201, 0x0200086304502a00, 0x4080010022000080, 0x0080018002483100,
	0x6005800440008021, 0x4042402010004000, 0x0013004620001100, 0x0081000810010021, 0x0000800800040080, 0x0101000300080400, 0x4402000802004144, 0x2007000045830002,
	0x120061800080c000, 0x0010004000502006, 0x4000820010402a00, 0x0140210009001000, 0x0208008080040008, 0x4800808004000200, 0x2040040008022130, 0x1800520000608104,
	0x0080004240002010, 0x0000400040201000, 0x3230401100200103, 0x0001020900100020, 0x1000040080800800, 0x8101000300280400, 0x0411080400104221, 0x4040010200109044,
	0x8000804004800820, 0x0010014000c02000, 0x6440900081802000, 0x8811380081801000, 0xa084004008080080, 0x4002000802000510, 0x0000081004000102, 0x2100800060800100,
	0x0000400280018021, 0x0800402010094004, 0x2401004020010010, 0x0210000800808010, 0x0080040008008080, 0x0480040002008080, 0x0003100201040008, 0x0840040090620001,
	0x8800210040800100, 0x0000205481020200, 0x1421200080100280, 0x0302044010082200, 0x0004000408008080, 0x0103800400020080, 0x1009000422002100, 0x400000509c010200,
	0x0041020080201042, 0x0400801204204102, 0xc884081100200041, 0x008a200804100101, 0x608a000420081002, 0x4101000204000801, 0x168a002120880402, 0x00200281084a2402
};

static constexpr std::array<uint64_t, 64> BishopMagicNumbers = {
	0x0060204082004040, 0x0010440800802000, 0x0011014401002080, 0x2008205841a40000, 0x08811040101a0000, 0x286104024000d101, 0xa014048888882011, 0x806a0100880c6200, 
	0x2001208202020400, 0x2002431011060281, 0x0280080841122244, 0x400a044408800100, 0x08001405a0200002, 0x85142104200440a0, 0x000c820610441585, 0x02308080a8080240, 
	0x2010040620080120, 0x4082000848180089, 0x0001008812102200, 0x40a8020082004000, 0x0602108c01040401, 0x410b000480454002, 0x228044c222022000, 0x8001082244421001, 
	0x0422100048909000, 0x8204504020020080, 0x008030000801c440, 0x000100418c040002, 0x2a04040020410048, 0x2410010120804100, 0x0001310104040100, 0x20840080002c8400, 
	0x803848404304c404, 0x5e08180446020417, 0x0002042208100090, 0x0020400809408200, 0x0040010011910040, 0x2021050200010804, 0x000a2c1104041080, 0x2548131140810040, 
	0x8c40888440511000, 0x040a04900908a400, 0x0088250040400800, 0x4801002018000100, 0x0010080100404400, 0x0054010045000204, 0x00020818210200a0, 0x100400a20200004a, 
	0x8000480804108a08, 0x4000804d082020a1, 0x2410088408884420, 0x1029201908680006, 0x014000c110410014, 0x2001202481aa0012, 0x11060810010214a2, 0x000808280888200e, 
	0x8040808828010400, 0x12008a021201040c, 0x04c8810102882400, 0x20c50004042a0801, 0x0080010011a20200, 0x0020010902480200, 0x400024a0140402a0, 0xf02808100c003020
};

static constexpr std::array<uint64_t, 64> RookMasks = {
	0x000101010101017e, 0x000202020202027c, 0x000404040404047a, 0x0008080808080876, 0x001010101010106e, 0x002020202020205e, 0x004040404040403e, 0x008080808080807e,
	0x0001010101017e00, 0x0002020202027c00, 0x0004040404047a00, 0x0008080808087600, 0x0010101010106e00, 0x0020202020205e00, 0x0040404040403e00, 0x0080808080807e00,
	0x00010101017e0100, 0x00020202027c0200, 0x00040404047a0400, 0x0008080808760800, 0x00101010106e1000, 0x00202020205e2000, 0x00404040403e4000, 0x00808080807e8000,
	0x000101017e010100, 0x000202027c020200, 0x000404047a040400, 0x0008080876080800, 0x001010106e101000, 0x002020205e202000, 0x004040403e404000, 0x008080807e808000,
	0x0001017e01010100, 0x0002027c02020200, 0x0004047a04040400, 0x0008087608080800, 0x0010106e10101000, 0x0020205e20202000, 0x0040403e40404000, 0x0080807e80808000, 
	0x00017e0101010100, 0x00027c0202020200, 0x00047a0404040400, 0x0008760808080800, 0x00106e1010101000, 0x00205e2020202000, 0x00403e4040404000, 0x00807e8080808000,
	0x007e010101010100, 0x007c020202020200, 0x007a040404040400, 0x0076080808080800, 0x006e101010101000, 0x005e202020202000, 0x003e404040404000, 0x007e808080808000,
	0x7e01010101010100, 0x7c02020202020200, 0x7a04040404040400, 0x7608080808080800, 0x6e10101010101000, 0x5e20202020202000, 0x3e40404040404000, 0x7e80808080808000
};

static constexpr std::array<uint64_t, 64> BishopMasks = {
	0x0040201008040200, 0x0000402010080400, 0x0000004020100a00, 0x0000000040221400, 0x0000000002442800, 0x0000000204085000, 0x0000020408102000, 0x0002040810204000, 
	0x0020100804020000, 0x0040201008040000, 0x00004020100a0000, 0x0000004022140000, 0x0000000244280000, 0x0000020408500000, 0x0002040810200000, 0x0004081020400000,
	0x0010080402000200, 0x0020100804000400, 0x004020100a000a00, 0x0000402214001400, 0x0000024428002800, 0x0002040850005000, 0x0004081020002000, 0x0008102040004000, 
	0x0008040200020400, 0x0010080400040800, 0x0020100a000a1000, 0x0040221400142200, 0x0002442800284400, 0x0004085000500800, 0x0008102000201000, 0x0010204000402000,
	0x0004020002040800, 0x0008040004081000, 0x00100a000a102000, 0x0022140014224000, 0x0044280028440200, 0x0008500050080400, 0x0010200020100800, 0x0020400040201000, 
	0x0002000204081000, 0x0004000408102000, 0x000a000a10204000, 0x0014001422400000, 0x0028002844020000, 0x0050005008040200, 0x0020002010080400, 0x0040004020100800, 
	0x0000020408102000, 0x0000040810204000, 0x00000a1020400000, 0x0000142240000000, 0x0000284402000000, 0x0000500804020000, 0x0000201008040200, 0x0000402010080400,
	0x0002040810204000, 0x0004081020400000, 0x000a102040000000, 0x0014224000000000, 0x0028440200000000, 0x0050080402000000, 0x0020100804020000, 0x0040201008040200
};

static constexpr std::array<int, 64> RookRelevantBits = {
	12, 11, 11, 11, 11, 11, 11, 12,
	11, 10, 10, 10, 10, 10, 10, 11,
	11, 10, 10, 10, 10, 10, 10, 11,
	11, 10, 10, 10, 10, 10, 10, 11,
	11, 10, 10, 10, 10, 10, 10, 11,
	11, 10, 10, 10, 10, 10, 10, 11,
	11, 10, 10, 10, 10, 10, 10, 11,
	12, 11, 11, 11, 11, 11, 11, 12
};

static constexpr std::array<int, 64> BishopRelevantBits = {
	6, 5, 5, 5, 5, 5, 5, 6,
	5, 5, 5, 5, 5, 5, 5, 5,
	5, 5, 7, 7, 7, 7, 5, 5,
	5, 5, 7, 9, 9, 7, 5, 5,
	5, 5, 7, 9, 9, 7, 5, 5,
	5, 5, 7, 7, 7, 7, 5, 5,
	5, 5, 5, 5, 5, 5, 5, 5,
	6, 5, 5, 5, 5, 5, 5, 6
};
